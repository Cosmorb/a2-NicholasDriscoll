<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Login — A3</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Login to view and manage your messages.">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body class="bg-dark text-light">
        <nav class="navbar navbar-dark bg-dark border-bottom border-secondary">
            <div class="container">
                <a class="navbar-brand" href="index.html">Nicholas Driscoll</a>
                <div class="d-flex gap-3">
                    <a class="nav-link text-light" href="index.html">About</a>
                    <a class="nav-link text-light" href="projects.html">Projects</a>
                    <a class="nav-link text-light active" href="login.html">Login</a>
                </div>
            </div>
        </nav>

        <main class="container py-5">
            <h1 class="mb-4">Login</h1>
            <form id="login-form" class="row g-3 col-md-5">
                <div class="col-12">
                    <label class="form-label" for="username">Username</label>
                    <input id="username" class="form-control" required>
                </div>
                <div class="col-12">
                    <label class="form-label" for="password">Password</label>
                    <input id="password" type="password" class="form-control" required>
                </div>
                <div class="col-12 d-flex gap-2 align-items-center">
                    <button class="btn btn-primary" type="submit">Log in</button>
                    <span id="msg" class="small text-warning"></span>
                </div>
                <p class="small text-secondary">
                    If the username doesn’t exist, an account will be created automatically.
                </p>
            </form>
        </main>

        <script>
            async function login(e){
                e.preventDefault();
                const body = JSON.stringify({
                    username: document.querySelector('#username').value.trim(),
                    password: document.querySelector('#password').value
                });
                const res = await fetch('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body
                });
                if(res.ok){
                    location.href = 'storage.html';
                } else {
                    const data = await res.json().catch(()=>({}));
                    document.querySelector('#msg').textContent = data.error || 'Login failed';
                }
            }
            document.querySelector('#login-form').addEventListener('submit', login);
        </script>
    </body>
</html>